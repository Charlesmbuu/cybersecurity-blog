# Exploiting a mass assignment vulnerability

![monitor-1307227_1280](https://github.com/user-attachments/assets/1fdf1f4f-4f20-4681-a4fa-30dd516c23a5)

---

## Objective

To sove this lab, we are to:
  - Find and exploit a mass assignment vulnerability to buy a **Lightweight l33t Leather Jacket**.
  - We can log in to our own account using the following credentials given: `wiener:peter` (username:password respectively).

> Required Knowledge for this challenge
- To solve this lab, we need to know:
```
- What mass assignment is.
- Why mass assignment may result in hidden parameters.
- How to identify hidden parameters.
- How to exploit mass assignment vulnerabilites.
```

---

## Methodology

1. The first order of business ğŸ’¼ will be to log in to the application using our provided credentials `weiner:peter` (username:password respectively).
   Click on **`My Account`** that is on the top left of the application, to access the log in page, and input the loggings.

<img width="960" alt="1" src="https://github.com/user-attachments/assets/e96acb52-120b-401e-8896-1b8db4173254" />

---

2. Go to the homepage by clicking on **`Home`**. Once we are there, click on **`Lighweight l33t Leather Jacket`** product since the mission objective states that we are to buy the leather jacket ğŸ§¥.

<img width="958" alt="2A" src="https://github.com/user-attachments/assets/f38d8d8a-cdf2-4392-80d8-2b6e6cfd06e2" />

Finally, add it to the basket/cart.

<img width="960" alt="2" src="https://github.com/user-attachments/assets/1e412ccb-f89c-44fc-84bc-ee885ac85397" />

---

3. Head over to the basket ğŸ§º and click **`Place order`** with our [Burp Suite](https://portswigger.net/burp/releases/professional-community-2024-11-2?requestededition=community&requestedplatform=) onğŸ‘Œ and âœ… ready to intercept the traffic ğŸš§ğŸš¦that is to be sent. Our expecation is to capture the checkout API, and see what it entails.

<img width="960" alt="3A" src="https://github.com/user-attachments/assets/d4f42156-66a9-4e92-8747-95f0a7a02620" />

Unfortunately, notice we are told that we don't have enough credit for the purchase upon clicking **`Place order`**â˜¹ï¸.

<img width="479" alt="3B" src="https://github.com/user-attachments/assets/3bef0209-6f00-4b91-947d-eb3f467a4d9b" />

---

4. Let's swtich gears and go to our Burp Suite. In the **Proxy > HTTP history**, there are two API requests, i.e. `POST` and `GET`. That's some good news ğŸ˜...just what we wantğŸ˜Œ.

<img width="480" alt="4" src="https://github.com/user-attachments/assets/8714e6ad-4932-4705-adbb-65b7d8ced78d" />

---

5. Notice that the *Response* to the **`GET`** request includes a `chosen_discount` parameter which is not present in the **`POST`** request, despite of both of **`GET`** and **`POST`** requests containing the same JSON structure.

<img width="960" alt="5" src="https://github.com/user-attachments/assets/cb684427-a178-4d0a-8826-bfd72679f0d5" />

---

6. We will take the **`POST`** request to our "investigation" ğŸ•µï¸ room (Repeater in Burp Suite); Right-click the `POST /api/checkout` request and select **Send to Repeater**.

<img width="960" alt="6" src="https://github.com/user-attachments/assets/51c854ec-4f40-42cf-bdd9-65ac1c00ff2a" />

---

7. Here onwards, is where we get our hands dirty with API as we play around with it in our Burp Suite.

In the **Repeater**, add the `chosen_discount` parameter to the request. The JSON should look like the following below: ğŸ‘‡
```
{
  "chosen_discount":{
    "percentage": 0
  },
  "chosen_product":[
    {
      "product_id":"1",
      "quantity":1
    }
  ]
}
```

- In the *Repeater*, it should now look like this:

<img width="960" alt="7" src="https://github.com/user-attachments/assets/941b8389-7688-431d-a71e-b079e1d09b86" />

[***Send***] the request.

---

8. Hahaaa! ğŸ˜

   ![NiceClickNiceGIF](https://github.com/user-attachments/assets/0ae6f12b-33ee-4d8f-bdd8-54d70be83d06)

There is no error ğŸš¨ğŸš© after adding the `chosen_discount` parameter indicating that there are possibilites that we could modify the enumerated `chosen_discount` parameter value. 

<img width="960" alt="8" src="https://github.com/user-attachments/assets/8f08bdd1-ddfe-4684-8847-85c8f7545bd4" />

---

9. We will proceed to modify the `chosen_discount` value to string `"x"`. then [***Send***] the request in the *Repeater*.

This results in an error ğŸš¨ğŸš© that the parameter is not a number.

<img width="403" alt="9" src="https://github.com/user-attachments/assets/7bd6950e-534b-4dc8-856e-c8d83771a3e7" />

This may then indicate that the user input is actually being processed. 

Fabulous! ğŸ˜ In short, the error suggests that the invalid value (`"x"`) impacts the query logic, but the valid value (`0`) doesn't. Meaning, this may indicate that the parameter can be successfully updated by the user...only if, we provide it with the valid value.

![SoAmazingSimonCowellGIF](https://github.com/user-attachments/assets/e8d994a9-4de0-4ee7-851b-198e03f0c925)

Things have just become amazing, guys! ğŸ˜ŒğŸ‘Œ

---

10. For the last piece of the puzzle to perform the hack...

    ![HackThePlanetHackerCatGIF](https://github.com/user-attachments/assets/14074575-3b25-46f7-b988-0c7215ebbd4c)

- Change the `chosen_discount` percentage to `100`, then [***Send***] the request to solve the lab.

<img width="403" alt="10" src="https://github.com/user-attachments/assets/31feb0d1-386e-4776-9e9b-3eb5e508b5da" />

![HackHackerGIF](https://github.com/user-attachments/assets/b9d55ecb-95c8-40c4-960c-b72e3bc63dc3)

> This way, we will have a 100% discount on the price for our leather jacket that we just added to the basket ğŸ˜.

### Vwalaaah! ğŸ˜ŒğŸ¥³ğŸ’ª

<img width="638" alt="fin" src="https://github.com/user-attachments/assets/4b06d571-5b91-4fde-85dd-7087e104d3d5" />

â­ Mission Accomplished â­
- Just bought a $1337 leather jacket for free!ğŸ˜ğŸ˜
 
---

### Conclusion

This bug is dangerous in the real world out there. Being able to change what is logically not supposed to be changed as a normal user is quite hazardous. It could lead to loses, damages, and even lack of trust from the users of an application.

It is therefore important for developers to fix this by ensuring they only allow changes to data that users are actually allowed to modify.

---

### Reference

[PortSwigger](https://portswigger.net/web-security/learning-paths/api-testing) - Web Security Academy - API Testing

---

### Date completed

- Jan 10 2024
