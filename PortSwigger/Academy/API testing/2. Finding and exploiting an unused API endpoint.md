# Finding and Exploiting an Unused API Endpoint

![pexels-realtoughcandy-11035364](https://github.com/user-attachments/assets/5a260f88-03e8-4f31-a3a0-26b877c523c0)

---

## Objective

- To solve this lab,  we need to exploit a hidden API endpoint to buy a **Lightweight l33t Leather Jacket**.
- We can log in to our own account  using the following credentials: `wiener:peter`(username:password respectively).

> Required Knowledge
```
To solve this lab, we will need to know:
  - How to  use error messages to construct a valid request.
  - How HTTP methods are used by RESTful APIs.
  - How changing the HTTP method can reveal additional functionality.
```

---

## Methodology

1. First order of business, access the lab. With the browser of our choice that is connected to Burp Suite, we can the proceed to start by first clicking on a product ğŸ and see what is behind it with our Burp Suite ready to intercept the trafficğŸš§ğŸš¥.

<img width="194" alt="Screenshot 2025-01-08 115935" src="https://github.com/user-attachments/assets/41916588-6038-4832-8ae1-2d18f37c4d80" />
   
---

2. In `Proxy > HTTP history`, there is an API request for the product. Cool!ğŸ˜—

This is actually what I want to seeğŸ’.

<img width="826" alt="1st API req" src="https://github.com/user-attachments/assets/bfa6ef07-931f-4cfb-982d-1605a75aa63a" />

And upon clicking on the history, we get to see the ***Response*** window returning the price,(`$1337.00`), response back with a message, "`12 people have viewed this item  in the last 10 minutes`".

---

3. Next action is to send that ***Request*** to our *Repeater* in Burp Suite, by clicking **`Send to Repeater`**...so as to get our hands dirty ğŸ˜‹ with some API work ğŸ¦ºğŸ‘·â€â™‚ï¸ and investigations ğŸ•µï¸â€â™‚ï¸ in a lovely and controlled environment.

   <img width="829" alt="image" src="https://github.com/user-attachments/assets/231c8ac4-25ed-493f-8947-28a85a014049" />


---

4. Switch to the *Repeater* tab

<img width="416" alt="Repeater" src="https://github.com/user-attachments/assets/5d4fcb2a-0a76-474a-b01b-eb0cd2dc8481" />

From here, we can change and alter the HTTP method for the API request from `GET` to `OPTIONS`, then send the request.

<img width="898" alt="Response 1" src="https://github.com/user-attachments/assets/bd9e2475-620f-498e-905b-8bcaf3544682" />

Notice our *Response* returns a sad message: "`Method Not Allowed`"ğŸ˜ğŸ’”. 

However, in the *Response*, it has specified the only allowed methods are `GET` and `PATCH`.

<img width="358" alt="allowed methods" src="https://github.com/user-attachments/assets/d62b8601-e564-47e1-9920-0ba2b1eee25e" />

---

5. So let's get right on to itğŸ˜‹ğŸ’ª. Start by changing the method for the API request from `GET` to `PATCH`, then [***Send***] the request.

<img width="715" alt="unauthorized" src="https://github.com/user-attachments/assets/bc606c92-7130-4786-a102-be17e089083d" />

   Notice, the reponse returns an **`Unauthorised`** message ğŸš¨ğŸš©. Authorization comes with logging in, and even in this case, we hadn't logged in yet into the application. Hence this may indicate that we need to be authenticated to update the order.

---

6. Without waasting time, log in into the application using the credentials given earlier in our objective: `weiner:peter` (username:password respectively).

   <img width="960" alt="logins" src="https://github.com/user-attachments/assets/be949194-b9a9-4be1-83bc-93e0b4fe3546" />

---

7. Once we are in, head over to the home page and click on the `**Lightweight "l33t" Leather Jacket` product, with our Burp Suite ready to intercept that traffic.

<img width="959" alt="Ready for the next step" src="https://github.com/user-attachments/assets/bf8595f1-c1f8-47a0-8ca2-77163d2bc06b" />

---

8. Head over to **`Proxy > HTTP history`**, right click the `API/products/1/price` request for the leather jacket and select **`Send to Repeater`**, for investigation ğŸ•µï¸â€â™‚ï¸.

![Repeater1](https://github.com/user-attachments/assets/d5c98b46-4557-47f9-97be-ca9443ab1e67)

---

9. In the investigation room (Repeater tab), change the HTTP method for the API request from `GET` to `PATCH`, then [***Send***] the request, just as shown below ğŸ‘‡.

<img width="718" alt="9" src="https://github.com/user-attachments/assets/697ad050-4070-4191-9e37-9ae88e9dac45" />

Notice, there is an error ğŸš¨ in the *Response*, "`Only 'application/json' Content-Type is supported`"ğŸš©. The error message specifies that the `Content-Type` should be `application/json`.

---

10. That gives us a clue ğŸ˜ƒ... We will try adding the required specifications to the *Request*, i.e. `Content-Type` header, with the value set to `application/json`. Easy peasy ğŸ˜ŒğŸ¤š.

> To do this:
  - Open the `Inspector` by clicking on the **`Inspector`** pane on our right side of Burp Suite.

<img width="962" alt="10" src="https://github.com/user-attachments/assets/287f6e03-8394-4154-bc98-97eece323401" />

  - Scroll down and click on the litte `[+]` plus sign and input the values respectively, starting with **Name**: `Content-Type`, and lastly **Value**: `application/json`.

<img width="960" alt="10B" src="https://github.com/user-attachments/assets/de211786-cee0-40ca-b60e-789f1453c2ec" />

---

11. Before we [***Send***] the request, add an empty JSON object as the request body. This can be done by adding `{}` right below in the request body, then [***Send***] the request.

<img width="960" alt="11" src="https://github.com/user-attachments/assets/d29d0a13-e243-4d27-920a-9632b57aa4eb" />

Unfortunately, an error ğŸš¨ occured with the message "`'price' parameter missing in body`"ğŸš©. This is because the request body is missing a `price` parameter.

---

12. So as to deal with the error ğŸš¨, add a `"price"` parameter with a value of `0` to the JSON object we added earlier to now read `{"price": 0}` on the *Request* body.

![12](https://github.com/user-attachments/assets/662a9a53-6701-4cf6-8d06-414e66c5669a)

- [***Send***] the request.

- Error gone! ğŸ‰ğŸŠğŸª„ğŸ¥³

  ![SeinfeldExcitedGIF](https://github.com/user-attachments/assets/4dd08fc3-a886-4031-8378-a84a45656d4c)

---

13. In our browser that had Burp Suite connected to it, reload the leather jacket product page and see the magicğŸª„ that has happenedğŸ˜.

<img width="960" alt="13" src="https://github.com/user-attachments/assets/53a5cafe-603c-4cef-a400-fb1e906f6a54" />

Noticed the price of the leather jacket is now `$0.00`?ğŸ˜

Yeah! Just like that we have a free leather jacket!!!ğŸ˜‚ğŸ˜

![YayGIF](https://github.com/user-attachments/assets/62afbf48-8ce7-437d-8be6-5e483a9d5a0a)

---

14. Quick! Add the leather jacket to the basket/cart...before someone catches us purchasing a free jacket!ğŸ‘€

<img width="877" alt="14" src="https://github.com/user-attachments/assets/ec489b0f-536f-4d5a-8027-55d1de9d5c0b" />

---

15. To solve the lab, go to the basket and click `Place order`.

<img width="960" alt="15" src="https://github.com/user-attachments/assets/453e362a-7f92-4be3-bc7a-e1aecb582b89" />

â­ Mission Complete! â­

<img width="959" alt="15B" src="https://github.com/user-attachments/assets/9af161ce-c25b-468f-a102-7eb8fe8f0e6b" />

Adios Muchachas! ğŸ˜Œ ... Peace! âœŒï¸

---

### Conclusion

Yoh! If this attack can be carried out on platforms such as Amazon, and other shopping platforms...someone will be rich ğŸ¤‘ really bad! Stay safe and happy ğŸ˜Š hacking ğŸ§‘â€ğŸ’»!

![HackerTypingGIF](https://github.com/user-attachments/assets/58139fad-ab71-4fa0-9fc6-01ee5e3360ab)

---

### Reference

[PortSwigger](https://portswigger.net/web-security/learning-paths/api-testing) - Web Security Academy - API Testing

---
### Date Completed
- Jan 9 2024
